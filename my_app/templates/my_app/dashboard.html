{% extends 'my_app/base.html' %}

{% block content %}
    <h1>Dashboard</h1>
    
    <h2>Log a Workout</h2>
    <form method="post">
        {% csrf_token %}
        {{ form.as_p }}
        <div id="exercise-suggestions"></div>
        <button type="submit">Log Workout</button>
    </form>
    
    <h2>Recent Workouts</h2>
    {% if workouts %}
        <ul>
        {% for workout in workouts %}
            <li class="workout-item">
                <span class="workout-details">{{ workout.exercise }} - {{ workout.duration }} mins ({{ workout.date }})</span>
                <form method="post" action="{% url 'delete_workout' workout.id %}" class="delete-form">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </li>
        {% endfor %}
        </ul>
    {% else %}
        <p>No workouts logged yet.</p>
    {% endif %}

    <script>
        document.getElementById('id_exercise').addEventListener('input', function() {
            const query = this.value;
            fetch(`/search_exercises/?q=${query}`)
                .then(response => response.json())
                .then(data => {
                    const suggestions = document.getElementById('exercise-suggestions');
                    suggestions.innerHTML = '';
                    data.exercises.forEach(ex => {
                        const option = document.createElement('div');
                        option.textContent = ex;
                        option.onclick = () => {
                            document.getElementById('id_exercise').value = ex;
                            suggestions.innerHTML = '';
                        };
                        suggestions.appendChild(option);
                    });
                });
        });
    </script>
{% endblock %}