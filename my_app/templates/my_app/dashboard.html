{% extends 'my_app/base.html' %}

{% block content %}
    <h1>Dashboard</h1>
    
    <h2>Search Exercises</h2>
    <input type="text" id="exercise-search" placeholder="Type an exercise...">
    <div id="suggestions" class="suggestions-dropdown"></div>
    
    <h2>Log a Workout</h2>
    <form method="post" id="workout-form" class="workout-form">
        {% csrf_token %}
        {% if form.errors %}
            <ul class="errorlist">
                {% for field, errors in form.errors.items %}
                    {% for error in errors %}
                        <li>{{ field }}: {{ error }}</li>
                    {% endfor %}
                {% endfor %}
            </ul>
        {% endif %}
        {{ form.as_p }}
        <button type="submit" class="submit-btn">Log Workout</button>
    </form>
    
    <h2>Your Recent Workouts</h2>
    <ul>
        {% for workout in workouts %}
            <li class="workout-item">
                <span class="workout-details">{{ workout.exercise }} - {{ workout.duration }} mins ({{ workout.date }})</span>
                <form method="post" action="{% url 'delete_workout' workout.id %}" class="delete-form">
                    {% csrf_token %}
                    <button type="submit" class="delete-btn">Delete</button>
                </form>
            </li>
        {% empty %}
            <li>No workouts yet!</li>
        {% endfor %}
    </ul>
    
    <script>
        const searchInput = document.getElementById('exercise-search');
        const suggestionsDiv = document.getElementById('suggestions');
        const exerciseField = document.getElementById('id_exercise');
        searchInput.addEventListener('input', function() {
            const query = this.value;
            if (query.length > 0) {
                fetch(`/search-exercises/?q=${query}`)
                    .then(response => response.json())
                    .then(data => {
                        suggestionsDiv.innerHTML = '';
                        data.exercises.forEach(exercise => {
                            const div = document.createElement('div');
                            div.textContent = exercise;
                            div.className = 'suggestion-item';
                            div.onclick = () => {
                                exerciseField.value = exercise;
                                suggestionsDiv.innerHTML = '';
                            };
                            suggestionsDiv.appendChild(div);
                        });
                    })
                    .catch(error => console.error('Error:', error));
            } else {
                suggestionsDiv.innerHTML = '';
            }
        });
    </script>
{% endblock %}