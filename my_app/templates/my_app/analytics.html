{% extends 'my_app/base.html' %}
{% load static %}

{% block content %}
    <h1>Analytics</h1>
    
    <div class="stats-container">
        <h2>Summary</h2>
        <p>Total Workout Time: {{ total_minutes }} minutes</p>
        <p>Workouts Logged: {{ workout_count }}</p>
        <p>Average Duration: {{ avg_duration|floatformat:1 }} minutes</p>
    </div>
    
    <div class="charts-wrapper">
        <div class="chart-container">
            <h2>Daily Workout Minutes (Last 7 Days)</h2>
            <canvas id="dailyChart"></canvas>
        </div>
        <div class="chart-container">
            <h2>Weekly Trends (Last 4 Weeks)</h2>
            <canvas id="weeklyChart"></canvas>
        </div>
    </div>
    
    <div class="exercises-container">
        <h2>Top Exercises</h2>
        {% if top_exercises %}
            <ul>
                {% for ex in top_exercises %}
                    <li>{{ ex.exercise }}: {{ ex.count }} times</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No workouts logged yet.</p>
        {% endif %}
    </div>
    
    <div class="goals-container">
        <h2>Active Goals</h2>
        {% if active_goals %}
            <ul>
                {% for goal in active_goals %}
                    <li>{{ goal.description }}: {{ goal.progress|default:0 }} / {{ goal.target_minutes }} mins</li>
                {% endfor %}
            </ul>
        {% else %}
            <p>No active goals.</p>
        {% endif %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        // Daily Bar Chart
        const dailyData = {{ daily_data|safe }};
        const dailyLabels = dailyData.map(d => d.date);
        const dailyMinutes = dailyData.map(d => d.minutes);
        new Chart(document.getElementById('dailyChart'), {
            type: 'bar',
            data: {
                labels: dailyLabels,
                datasets: [{
                    label: 'Minutes',
                    data: dailyMinutes,
                    backgroundColor: '#00cc99',
                    borderColor: '#00cc99',
                    borderWidth: 1
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });

        // Weekly Line Chart
        const weeklyData = {{ weekly_data|safe }};
        const weeklyLabels = weeklyData.map(d => d.week);
        const weeklyMinutes = weeklyData.map(d => d.minutes);
        new Chart(document.getElementById('weeklyChart'), {
            type: 'line',
            data: {
                labels: weeklyLabels,
                datasets: [{
                    label: 'Minutes',
                    data: weeklyMinutes,
                    borderColor: '#00cc99',
                    backgroundColor: 'rgba(0, 204, 153, 0.2)',
                    fill: true,
                    tension: 0.3
                }]
            },
            options: {
                scales: {
                    y: { beginAtZero: true }
                }
            }
        });
    </script>
{% endblock %}